<!DOCTYPE html>
<html lang="it">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tris Online</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
        }
        
        .grid {
            display: grid;
            grid-template-columns: repeat(3, 100px);
            grid-gap: 5px;
            margin: 20px auto;
        }
        
        .cell {
            width: 100px;
            height: 100px;
            border: 1px solid #000;
            font-size: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
        }
        
        .cell.taken {
            cursor: not-allowed;
        }
    </style>
</head>

<body>

    <script>
        const socket = new WebSocket('ws://localhost:8080');

        let playerSymbol = null;
        let currentTurn = 'X';
        let board = Array(9).fill(null);

        socket.onmessage = (event) => {
            const data = JSON.parse(event.data);

            switch (data.type) {
                case 'lobby_created':
                case 'lobby_joined':
                    playerSymbol = data.symbol;
                    board = data.board || Array(9).fill(null);
                    currentTurn = data.turn || 'X';
                    updateBoard();
                    document.getElementById('status').innerText = `Sei il giocatore: ${playerSymbol}`;
                    break;

                case 'player_joined':
                    alert('Un altro giocatore si è unito! Il gioco può iniziare.');
                    break;

                case 'move':
                    board[data.move.index] = data.move.symbol;
                    currentTurn = data.turn;
                    updateBoard();
                    break;
                case 'chat':

            }
        };

        function createLobby() {
            const lobbyName = document.getElementById('lobbyName').value;
            socket.send(JSON.stringify({
                type: 'create_lobby',
                lobby: lobbyName
            }));
        }

        function joinLobby() {
            const lobbyName = document.getElementById('lobbyName').value;
            socket.send(JSON.stringify({
                type: 'join_lobby',
                lobby: lobbyName
            }));
        }

        function makeMove(index) {
            if (board[index] === null && currentTurn === playerSymbol) {
                socket.send(JSON.stringify({
                    type: 'move',
                    move: {
                        index
                    }
                }));
            }
        }

        function showLobby() {
            ws.send(JSON.stringify({
                type: 'showLobby',
                lobbies: lobby
            }));
        }

        function searchLobby() {
            const lobbyName = document.getElementById('lobbyName').value;
            socket.send(JSON.stringify({
                type: 'searchLobby',
                lobby: lobbyName
            }));
        }

        function updateBoard() {
            for (let i = 0; i < 9; i++) {
                document.getElementById(`cell-${i}`).innerText = board[i] || '';
            }
            document.getElementById('turn-indicator').innerText = `Turno di: ${currentTurn}`;
        }

        document.addEventListener('DOMContentLoaded', () => {
            document.querySelectorAll('.cell').forEach((cell, index) => {
                cell.addEventListener('click', () => makeMove(index));
            });

            document.getElementById('createLobbyBtn').addEventListener('click', createLobby);
            document.getElementById('joinLobbyBtn').addEventListener('click', joinLobby);
        });

        // HTML TEMPLATE

        document.body.innerHTML = `
    <h1>Tris Online</h1>
    <input type="text" id="lobbyName" placeholder="Nome della lobby">
    <button id="createLobbyBtn">Crea Lobby</button>
    <button id="joinLobbyBtn">Unisciti alla Lobby</button>
    <p id="status">In attesa...</p>
    <p id="turn-indicator">Turno di: X</p>
    <div id="board" style="display: grid; grid-template-columns: repeat(3, 100px); gap: 5px;">
        ${Array(9).fill(0).map((_, i) => `<div class="cell" id="cell-${i}" style="width: 100px; height: 100px; border: 1px solid black; display: flex; align-items: center; justify-content: center; font-size: 24px; cursor: pointer;"></div>`).join('')}
    </div>
    <div id="chat">
        <input type="text" id="chatInput" placeholder="Esprimi la tua diarrea vocalica:">
        <button id="sendChatBtn">Invia</button>
        <div id="chatMessages"></div>
`;
    </script>
</body>

</html>